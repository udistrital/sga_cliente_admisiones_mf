<mat-card>
  <mat-card-content>
    <h2>{{ "admision.evaluacion_aspirantes" | translate }}</h2>

    <!-- FORMULARIO -->
    <section *ngIf="showTab">
      <div *ngIf="!(show_profile || show_icfes)">
        <!-- FORMULARIO DE SELECTS -->
        <section>
          <!--Periodo académico-->
          <mat-form-field style="width: 100%">
            <mat-label>{{ "admision.periodo_" | translate }}:</mat-label>
            <mat-select
              [(ngModel)]="periodo"
              (selectionChange)="selectPeriodo()"
            >
              <mat-option
                >--{{ "GLOBAL.seleccionar" | translate }}--</mat-option
              >
              <mat-option *ngFor="let item of periodos" [value]="item">
                {{ item.Nombre }}
              </mat-option>
            </mat-select>
          </mat-form-field>

          <!-- select Nivel -->
          <mat-form-field style="width: 100%">
            <mat-label>{{ "admision.aviso_nivel" | translate }}:</mat-label>
            <mat-select
              [formControl]="CampoControl"
              [(ngModel)]="selectednivel"
              (selectionChange)="cambiarSelectPeriodoSegunNivel($event.value)"
            >
              <mat-option value="">{{
                "GLOBAL.seleccionar" | translate
              }}</mat-option>
              <mat-option *ngFor="let item of nivel_load" [value]="item.Id">
                {{ item.Nombre }}
              </mat-option>
            </mat-select>
            <mat-error *ngIf="CampoControl.hasError('required')">
              {{ "admision.erro_selec_nivel" | translate }}
            </mat-error>
          </mat-form-field>

          <!-- select Proyectos -->
          <mat-form-field style="width: 100%">
            <mat-label>{{ "admision.aviso_proyecto" | translate }}:</mat-label>
            <mat-select
              [formControl]="Campo1Control"
              [(ngModel)]="proyectos_selected"
              (selectionChange)="
                consultarPeriodosDoctorado(proyectos_selected);
                this.loadCriterios()
              "
            >
              <mat-option value="">{{
                "GLOBAL.seleccionar" | translate
              }}</mat-option>
              <mat-option *ngFor="let item of proyectos" [value]="item.Id">{{
                item.Nombre
              }}</mat-option>
            </mat-select>
            <mat-error *ngIf="Campo1Control.hasError('required')">
              {{ "admision.erro_selec_proyecto" | translate }}
            </mat-error>
          </mat-form-field>

          <!-- select criterios -->
          <mat-form-field style="width: 100%">
            <mat-label>{{ "admision.aviso_criterios" | translate }}:</mat-label>
            <mat-select
              [formControl]="Campo2Control"
              [(ngModel)]="criterio_selected"
              (selectionChange)="viewtab()"
              [disabled]="selectcriterio"
              multiple
            >
              <mat-option
                *ngFor="let item of criterios"
                [value]="item.RequisitoId"
              >
                {{ item.RequisitoId.Nombre }}
              </mat-option>
            </mat-select>
            <mat-error *ngIf="Campo2Control.hasError('required')">
              {{ "admision.erro_selec_criterio" | translate }}
            </mat-error>
          </mat-form-field>
        </section>

        <!-- Tag de criterios -->
        <section class="container-tag-criterios">
          <div class="container">
            <div id="info_basica" *ngFor="let criterio of criterio_selected">
              <mat-card
                class="exp-card"
                *ngIf="criterio.Nombre != 'ICFES'"
                (click)="perfil_editar(criterio)"
              >
                <mat-card-header class="exp-card-header">{{
                  "Criterio " + ajustarTitulo(criterio.Nombre)
                }}</mat-card-header>
                <mat-card-content class="exp-card-content">
                  <mat-icon
                    fontIcon="edit_square"
                    class="exp-card-content-icon"
                  ></mat-icon>
                </mat-card-content>
              </mat-card>
            </div>
          </div>

          <!--Botón de calculo de nota final-->
          <div class="text-center">
            <button
              mat-flat-button
              color="accent"
              type="button"
              *ngIf="notas"
              (click)="calcularEvaluacion()"
              [disabled]="btnCalculo"
            >
              {{ "admision.calcular" | translate }}
            </button>
          </div>

          <div>
            <button
              mat-flat-button
              color="accent"
              type="button"
              *ngIf="mostrarBoton"
              (click)="selectPeriodo()"
            >
              <mat-icon
                style="vertical-align: middle"
                fontIcon="add"
              ></mat-icon>
              <label>{{ "GLOBAL.buscar" | translate }}</label>
            </button>
          </div>

          <div *ngIf="mostrarMensajeInicial" class="alert warning margin-y">
            <mat-icon class="icon">info</mat-icon>
            <span
              >{{ "gestion_horarios.mensaje_doctorado" | translate }} :
              {{ nombresPeriodos }}
              {{
                "gestion_horarios.mensaje_doctorado_mensaje" | translate
              }}</span
            >
          </div>
        </section>
      </div>
    </section>

    <!-- SECCION DE EVALUACION DE ASPIRANTES POR CRITERIO -->
    <section *ngIf="!showTab" class="margin-y">
      <div class="margin-y">
        <p>
          <strong>{{ "admision.criterio" | translate }}: </strong
          >{{ tipo_criterio.Nombre }}
        </p>

        <p>
          <strong>{{ "admision.programa" | translate }}: </strong
          >{{ tipo_criterio.ProgramaAcademico }}
        </p>

        <p>
          <strong>{{ "admision.periodo" | translate }}: </strong
          >{{ tipo_criterio.Periodo }}
        </p>
      </div>
      <div class="alert info margin-y">
        <mat-icon class="icon">info</mat-icon>
        <span
          ><strong>{{ "admision.nota" | translate }}:</strong>
          {{ "admision.aviso" | translate }}. <br />
          {{ "admision.aviso_no_edicion" | translate }}</span
        >
      </div>

      <label
        >{{ "admision.total_aspirantes" | translate }}:
        <b>{{ cantidad_aspirantes }}</b></label
      >
      <br />

      <form [formGroup]="formGroupTable">
        <div class="table" *ngIf="tableReady">
          <table mat-table [dataSource]="dataSource" matSort class="full-width-table">
            
            <!-- Definición de las columnas -->
            <ng-container *ngFor="let title of columnas; let i = index" [matColumnDef]="title">
              
              <th mat-header-cell *matHeaderCellDef mat-sort-header [style.width]="widhtColumns[i]">
                {{ title }}
              </th>
      
              <!-- Columna de Aspirantes -->
              <ng-container *ngIf="title === 'Aspirants' || title === 'Aspirantes'">
                <td mat-cell *matCellDef="let row">
                  {{ row.Aspirantes }}
                </td>
              </ng-container>
      
              <!-- Columna de Asistencia -->
              <ng-container *ngIf="title === 'Attendance' || title === 'Asistencia'">
                <td mat-cell *matCellDef="let row">
                  <input type="checkbox" class="input-table" [formControlName]="'Asistencia'" />
                </td>
              </ng-container>
      
              <!-- Otras columnas con controles dinámicos -->
              <ng-container *ngIf="title !== 'acciones' && title !== 'Asistencia' && title !== 'Aspirantes'">
                <td mat-cell *matCellDef="let row">
                  <!-- {{title}} -->
                  <input type="text" class="input-table" [formControlName]="title" />
                </td>
              </ng-container>
      
              <!-- Columna de acciones -->
              <ng-container *ngIf="title === 'acciones'">
                <td mat-cell *matCellDef="let row" style="width: 8%">
                  <!-- Lógica para las acciones -->
                  <div class="separacion-acciones">
                    <button
                      aria-hidden="false"
                      class="table-button-edit"
                      *ngIf="!row.mostrarBotones"
                      title="{{ 'admision.tooltip_editar' | translate }}"
                      class="boton-primary"
                      (click)="itemSelect({ data: row }); buttonedit(row)"
                    >
                      <mat-icon fontIcon="edit"></mat-icon>
                    </button>
                    <button
                      aria-hidden="false"
                      *ngIf="row.mostrarBotones"
                      title="{{ 'admision.tooltip_guargar' | translate }}"
                      class="boton-primary"
                      (click)="onEditConfirm({ newData: row }); buttonedit(row)"
                    >
                      <mat-icon fontIcon="check"></mat-icon>
                    </button>
                    <button
                      aria-hidden="false"
                      *ngIf="row.mostrarBotones"
                      title="{{ 'admision.tooltip_cancelar' | translate }}"
                      class="boton-primary"
                      (click)="buttonedit(row)"
                    >
                      <mat-icon fontIcon="close"></mat-icon>
                    </button>
                  </div>
                </td>
              </ng-container>
      
            </ng-container>
      
            <tr mat-header-row *matHeaderRowDef="columnas"></tr>
            <tr mat-row *matRowDef="let row; columns: columnas"></tr>
      
            <tr class="mat-row" *matNoDataRow>
              <td class="mat-cell" colspan="4">{{ "calendario.sin_procesos" | translate }}</td>
            </tr>
          </table>
          <mat-paginator #paginator [pageSize]="6" [showFirstLastButtons]="true"></mat-paginator>
        </div>
      </form>
      

      <br /><br />
      <button
        mat-flat-button
        color="primary"
        (click)="activateTab()"
        class="boton-primary"
      >
        <mat-icon fontIcon="arrow_back"></mat-icon>
        {{ "GLOBAL.regresar" | translate }}
      </button>
    </section>
  </mat-card-content>
</mat-card>
