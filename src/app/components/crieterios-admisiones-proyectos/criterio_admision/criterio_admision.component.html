<mat-card>
  <mat-card-content>
    <h2>{{ "admision.criterios_proyectos" | translate }}</h2>
    <div *ngIf="!(show_profile || show_icfes)">
      <!-- select periodo -->
      <mat-form-field class="form-field">
        <mat-label>{{ "admision.aviso_periodo" | translate }}:</mat-label>
        <mat-select
          [(ngModel)]="periodo"
          [disabled]="false"
          (selectionChange)="selectPeriodo()"
        >
          <mat-option>--{{ "GLOBAL.seleccionar" | translate }}--</mat-option>
          <mat-option *ngFor="let item of periodos" [value]="item">
            {{ item.Nombre }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <!-- select Nivel -->
      <mat-form-field class="form-field">
        <mat-label>{{ "admision.aviso_nivel" | translate }}:</mat-label>
        <mat-select
          [formControl]="CampoControl"
          [(ngModel)]="selectednivel"
          (selectionChange)="loadProyectos()"
        >
          <mat-option>--{{ "GLOBAL.seleccionar" | translate }}--</mat-option>
          <mat-option *ngFor="let item of niveles" [value]="item.Id">
            {{ item.Nombre }}
          </mat-option>
        </mat-select>
        <mat-error *ngIf="CampoControl.hasError('required')">
          {{ "admision.erro_selec_nivel" | translate }}
        </mat-error>
      </mat-form-field>

      <!-- select Facultad -->
      <mat-form-field class="form-field">
        <mat-label>{{ "admision.seleccion_facultad" | translate }}</mat-label>
        <mat-select
          [(ngModel)]="facultad"
          (selectionChange)="filtrarPorFacultades(facultad)"
        >
          <mat-option>
            {{ "GLOBAL.seleccionar" | translate }}
          </mat-option>
          <mat-option *ngFor="let item of facultades" [value]="item.Id">
            {{ item.Nombre }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <!-- select proyectos -->
      <mat-form-field class="form-field">
        <mat-label>{{ "admision.aviso_proyecto" | translate }}:</mat-label>
        <mat-select
          [formControl]="Campo1Control"
          [(ngModel)]="proyectos_selected"
          (selectionChange)="activeCriterios()"
        >
          <mat-option>--{{ "GLOBAL.seleccionar" | translate }}--</mat-option>
          <mat-option
            *ngFor="let project of proyectosFilteredFacultad"
            [value]="project.Id"
            [disabled]="!project.Id"
            >{{ project.Nombre }}</mat-option
          >
        </mat-select>
        <mat-error *ngIf="Campo1Control.hasError('required')">
          {{ "admision.erro_selec_proyecto" | translate }}
        </mat-error>
      </mat-form-field>

      <!-- select criterios -->
      <mat-form-field class="form-field">
        <mat-label>{{ "admision.aviso_criterios" | translate }}:</mat-label>
        <mat-select
          [formControl]="Campo2Control"
          [(ngModel)]="criterio_selected"
          (selectionChange)="viewtab()"
          [disabled]="selectcriterio"
          multiple
        >
          <mat-option *ngFor="let item of criterios" [value]="item">
            {{ item.Nombre }}
          </mat-option>
        </mat-select>
        <mat-error *ngIf="Campo2Control.hasError('required')">
          {{ "admision.erro_selec_criterio" | translate }}
        </mat-error>
      </mat-form-field>

      <section>
        <h3>{{ "admision.ofertar" | translate }}</h3>

        <div *ngFor="let checkbox of opciones; let i = index">
          <form [formGroup]="checkbox">
            <div class="row my-2">
              <div class="col-12">
                <mat-checkbox formControlName="opcion">
                  <mat-label
                    >{{ "admision.ofertar_opcion" | translate }}
                    {{ i + 2 }} ?</mat-label
                  >
                </mat-checkbox>
              </div>
            </div>
          </form>
        </div>
      </section>

      <!-- input adicional -->
      <ng-container *ngIf="criterioEsExamenEstado">
        <h3>{{ "admision.parametrizacion_puntaje" | translate }}</h3>

        <mat-form-field class="form-field">
          <mat-label>{{ "admision.valor_minimo" | translate }}</mat-label>
          <input
            matInput
            [(ngModel)]="valorMinimo"
            required
            pattern="^[1-9][0-9]*$"
          />
          <mat-error *ngIf="Campo2Control.hasError('required')">
            {{ "admision.erro_selec_criterio" | translate }}
          </mat-error>
          <mat-error *ngIf="Campo2Control.hasError('pattern')">
            {{ "admision.erro_valor_minimo" | translate }}
          </mat-error>
        </mat-form-field>
      </ng-container>

      <br />
      <!-- Tag de criterios -->
      <div class="row">
        <div
          style="display: flex; flex-wrap: wrap; gap: 1em"
          id="info_tipo"
          *ngIf="selectTipo == true"
        >
          <!-- CRITERIOS -->
          <div
            [ngStyle]="{
              'min-width': '500px',
              width: mostrarSubcriterio ? '48%' : '100%'
            }"
          >
            <h3>{{ "admision.criterios" | translate }}</h3>
            <div class="table" *ngIf="periodo && selectednivel && facultad">
              <table mat-table [dataSource]="dataSource" matSort>
                <ng-container matColumnDef="criterio">
                  <th
                    mat-header-cell
                    *matHeaderCellDef
                    mat-sort-header
                    style="width: 45%"
                  >
                    {{ "admision.criterio" | translate }}
                  </th>
                  <td mat-cell *matCellDef="let row">{{ row.Criterio }}</td>
                </ng-container>

                <ng-container matColumnDef="porentaje">
                  <th
                    mat-header-cell
                    *matHeaderCellDef
                    mat-sort-header
                    style="width: 30%"
                  >
                    {{ "admision.porcentaje" | translate }}
                  </th>
                  <td mat-cell *matCellDef="let row">
                    <mat-form-field>
                      <mat-label>{{
                        "admision.porcentaje" | translate
                      }}</mat-label>
                      <input
                        matInput
                        type="text"
                        class="input-table"
                        [(ngModel)]="row.Porcentaje"
                        [disabled]="!row.mostrarBotones"
                        #inputRef
                      />
                    </mat-form-field>
                  </td>
                </ng-container>

                <ng-container matColumnDef="acciones">
                  <th mat-header-cell *matHeaderCellDef mat-sort-header>
                    {{ "GLOBAL.acciones" | translate }}
                  </th>
                  <td mat-cell *matCellDef="let row">
                    <div class="separacion-acciones">
                      <button
                        mat-icon-button
                        *ngIf="row.Subcriterios && row.Subcriterios.length > 0"
                        (click)="openSubcriteriosDialog(row)"
                        title="{{ 'admision.ver_subcriterios' | translate }}"
                      >
                        <mat-icon>manufacturing</mat-icon>
                      </button>
                      <button
                        aria-hidden="false"
                        *ngIf="!row.mostrarBotones"
                        title="{{ 'admision.tooltip_editar' | translate }}"
                        color="accent"
                        mat-icon-button
                        (click)="
                          onEdit({ data: row, isSelected: false });
                          buttonedit(row)
                        "
                      >
                        <mat-icon fontIcon="edit"></mat-icon>
                      </button>
                      <button
                        aria-hidden="false"
                        *ngIf="row.mostrarBotones"
                        title="{{ 'admision.tooltip_guargar' | translate }}"
                        mat-icon-button
                        color="accent"
                        (click)="calcularPorcentaje(); buttonedit(row)"
                      >
                        <mat-icon fontIcon="check"></mat-icon>
                      </button>
                      <button
                        aria-hidden="false"
                        *ngIf="row.mostrarBotones"
                        title="{{ 'admision.tooltip_cancelar' | translate }}"
                        mat-icon-button
                        color="warn"
                        (click)="buttonedit(row)"
                      >
                        <mat-icon fontIcon="close"></mat-icon>
                      </button>
                    </div></td
                ></ng-container>

                <tr mat-header-row *matHeaderRowDef="dataSourceColumns"></tr>
                <tr
                  mat-row
                  *matRowDef="let row; columns: dataSourceColumns"
                ></tr>

                <!-- Row shown when there is no matching data. -->
                <tr class="mat-row" *matNoDataRow>
                  <td class="mat-cell" colspan="4">
                    {{ "calendario.sin_procesos" | translate }}
                  </td>
                </tr>
              </table>
            </div>
            <br />

            <div *ngIf="periodo && selectednivel && facultad">
              <div class="alert info" align="center">
                <label class="fondo_aviso">
                  <strong>{{ "admision.nota" | translate }}:</strong>
                  {{ "admision.aviso_sub" | translate }}
                </label>
              </div>
              <br />
              <div style="text-align: center; margin: 0 auto">
                <mat-label
                  >{{ "admision.total" | translate }}:
                  {{ porcentajeTotal }} %</mat-label
                >
              </div>
              <br />
              <div style="text-align: center; margin: 0 auto">
                <button
                  mat-flat-button
                  color="accent"
                  type="button"
                  (click)="guardar()"
                >
                  {{ "GLOBAL.guardar" | translate }}
                </button>
              </div>
            </div>
          </div>

          <!-- SUBCRITERIOS -->
          <div *ngIf="mostrarSubcriterio" style="min-width: 500px; width: 48%">
            <br />
            <h3>{{ "admision.subcriterios" | translate }}</h3>

            <div class="table">
              <table mat-table [dataSource]="dataSourceSubcriterio" matSort>
                <ng-container matColumnDef="criterio">
                  <th
                    mat-header-cell
                    *matHeaderCellDef
                    mat-sort-header
                    style="width: 45%"
                  >
                    {{ "admision.subCriterio" | translate }}
                  </th>
                  <td mat-cell *matCellDef="let row">
                    {{ row.Criterio }}
                  </td>
                </ng-container>

                <ng-container matColumnDef="porentaje">
                  <th
                    mat-header-cell
                    *matHeaderCellDef
                    mat-sort-header
                    style="width: 30%"
                  >
                    {{ "admision.porcentaje" | translate }}
                  </th>
                  <td mat-cell *matCellDef="let row">
                    <mat-form-field>
                      <input
                        matInput
                        type="text"
                        [(ngModel)]="row.Porcentaje"
                        [disabled]="!row.mostrarBotones"
                      />
                    </mat-form-field>
                  </td>
                </ng-container>

                <ng-container matColumnDef="acciones">
                  <th mat-header-cell *matHeaderCellDef mat-sort-header>
                    {{ "GLOBAL.acciones" | translate }}
                  </th>
                  <td mat-cell *matCellDef="let row">
                    <div class="separacion-acciones">
                      <button
                        aria-hidden="false"
                        *ngIf="!row.mostrarBotones"
                        title="{{ 'admision.tooltip_editar' | translate }}"
                        mat-icon-button
                        color="accent"
                        (click)="
                          onEditSubcriterio({ data: row }); buttonedit(row)
                        "
                      >
                        <mat-icon fontIcon="edit"></mat-icon>
                      </button>
                      <button
                        aria-hidden="false"
                        *ngIf="row.mostrarBotones"
                        title="{{ 'admision.tooltip_guargar' | translate }}"
                        mat-icon-button
                        color="accent"
                        (click)="
                          buttonedit(row)
                        "
                      >
                        <mat-icon fontIcon="check"></mat-icon>
                      </button>
                      <button
                        aria-hidden="false"
                        *ngIf="row.mostrarBotones"
                        title="{{ 'admision.tooltip_cancelar' | translate }}"
                        mat-icon-button
                        color="warn"
                        (click)="buttonedit(row)"
                      >
                        <mat-icon fontIcon="close"></mat-icon>
                      </button>
                    </div></td
                ></ng-container>

                <tr mat-header-row *matHeaderRowDef="dataSourceColumns"></tr>
                <tr
                  mat-row
                  *matRowDef="let row; columns: dataSourceColumns"
                ></tr>

                <tr class="mat-row" *matNoDataRow>
                  <td class="mat-cell" colspan="4">
                    {{ "calendario.sin_procesos" | translate }}
                  </td>
                </tr>
              </table>
            </div>
            <br />
            <div style="text-align: center; margin: 0 auto">
              <mat-label
                >{{ "admision.total" | translate }}:
                {{ porcentajeSubcriterioTotal }} %</mat-label
              >
            </div>
            <br />
            <div style="text-align: center; margin: 0 auto">
              <button
                mat-flat-button
                color="accent"
                type="button"
              >
                {{ "admision.guardarSubcriterio" | translate }}
              </button>
            </div>
          </div>

          <br />
        </div>
      </div>
    </div>
  </mat-card-content>
</mat-card>
